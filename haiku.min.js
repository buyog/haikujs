define([],function(){"use strict";function h(a,b,c){return a.replace(/\$([^$]*);/g,function(a,d){var e=b[d]||c,f=typeof e;return"string"===f||"number"===f?e:"("+f+")"})}function i(a,b){if(!a)return new Error("setNodeValue :: No node specified.");switch(a.tagName){case"INPUT":case"TEXTAREA":case"SELECT":"checkbox"===a.type?a.checked=b:a.value=b;break;default:a.textContent=b}}function j(a){var b=a.replace(/\+/gi,"__PLUS__");return b=b.replace(/\{/gi,"__OPENBRACE__"),b=b.replace(/\}/gi,"__CLOSEBRACE__"),b.replace(/\]/gi,"__CLOSEBRACKET__")}function k(a){var b=a.replace(/__PLUS__/gi,"+");return b=b.replace(/__OPENBRACE__/gi,"{"),b=b.replace(/__CLOSEBRACE__/gi,"}"),b.replace(/__CLOSEBRACKET__/gi,"]")}function l(a,b){var c=null;if(!a)return null;if(a.__SANITIZED)return a;if(Array.isArray(a)){c=[];for(var d=0;d<a.length;d++)c[d]=l(a[d],b)}else switch(typeof a){case"string":c=j(a);break;case"object":c={__SANITIZED:!0},b>0?Object.keys(a).forEach(function(d){c[d]=l(a[d],b-1)}):c.__NORECURSE=!0;break;default:c=a}return c}function m(a,b){if(!a||!b)return null;var c="span{"+a.replace(/%/g,"$")+"}",d=p(c,b);return d?d.textContent:null}function n(b){var h,i,j,l,g=a.exec(b),m=g?document.createElement(g[0]):null;if(m){if(e.test(b)&&(i=e.exec(b),j=k(i[0].slice(1,-1)),m.appendChild(document.createTextNode(j))),f.test(b))for(i=f.exec(b),j=k(i[0].slice(1,-1)),b=b.slice(0,i.index)+b.slice(i.index+i[0].length),i=j.split(","),h=0;h<i.length;h++)l=i[h].split("="),2==l.length?m.setAttribute(l[0],l[1]):l.length>2&&m.setAttribute(l[0],l.slice(1).join("="));for(c.test(b)&&(i=c.exec(b),m.id=i[0].slice(1)),i=d.exec(b);i&&i.length;){for(h=0;h<i.length;h++)m.classList.add(i[h].slice(1));i=d.exec(b)}}else e.test(b)&&(i=e.exec(b),j=k(i[0].slice(1,-1)),m=document.createTextNode(j));return m}function o(a,c,d){var j,k,e=d?document.createElement("div"):document.createDocumentFragment(),f=e,g=null,i=h(a,l(c,1),""),m=i.split(b);for(j=0;j<m.length;j++)if(g=n(m[j].trim()),g&&f.appendChild(g),k=b.exec(i),k&&k.length)switch(k[0]){case"<":f=f.parentNode;break;case">":f=g;break;case"+":break;default:console.warn("unrecognized position delimiter:",k)}return d?e.innerHTML:e}function p(a,b){var c=o(a,b);return c&&c.childNodes.length?c.childNodes[0]:null}function q(a,b){if(a&&b){if(g.hasOwnProperty(a))throw new Error("Template '"+a+"' already exists.");g[a]=b}}function r(a){return g[a]||null}function s(a,b){var c;a&&b&&(c=a.querySelectorAll("[data-children-binding]"),Array.prototype.forEach.call(c,function(a){var d,e,f,g,c=a.getAttribute("data-children-binding");if(c&&b.hasOwnProperty(c)){if(e=b[c],e&&void 0!==e.length&&(d=r(a.getAttribute("data-template")))){a.innerHTML="";for(var h=0;h<e.length;h++)f=p(d,e[h]),a.appendChild(f),s(f,e[h])}}else console.warn("Data children binding: '"+c+"' not found.");g=a.getAttribute("data-children-footer"),g&&(d=r(a.getAttribute("data-children-footer")),d&&a.appendChild(p(d,b)))}),c=a.querySelectorAll("[data-binding]"),Array.prototype.forEach.call(c,function(a){var d,e,c=a.getAttribute("data-binding");"%self"===c?(e=a.getAttribute("data-value-string"),i(a,m(e,b))):c&&b.hasOwnProperty(c)?(d=b[c],void 0!==d&&i(a,d)):console.warn("Data binding: '"+c+"' ")}))}var a=/^[a-z]+[1-6]?/i,b=/[><\+]/g,c=/#[_a-z]+[_a-z0-9-]*/i,d=/\.-?[_a-z]+[_a-z0-9-]*/gi,e=/{[^}]+}/,f=/\[[^\]]*\]/,g={};return{expand:o,create:p,bind:s,addTemplate:q,getTemplate:r}});