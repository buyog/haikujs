define([],function(){"use strict";function i(a,b,c){return a.indexOf("%self")>-1&&b&&(a=a.replace(/%self/g,b.toString())),a.replace(/\$([^$]*);/g,function(a,d){var e=b[d];n(e)&&(e=c);var f=typeof e;return"string"===f||"number"===f?e:"("+f+")"})}function j(a,b){for(var c in b)b.hasOwnProperty(c)&&void 0!==b[c]&&(a[c]=b[c]);return a}function k(a,b){if(!a)return new Error("setNodeValue :: No node specified.");switch(a.tagName){case"INPUT":case"TEXTAREA":case"SELECT":"checkbox"===a.type?a.checked=b:a.value=b;break;default:a.textContent=b}}function l(a){var b=a.replace(/\+/gi,"__PLUS__");return b=b.replace(/\{/gi,"__OPENBRACE__"),b=b.replace(/\}/gi,"__CLOSEBRACE__"),b.replace(/\]/gi,"__CLOSEBRACKET__")}function m(a){var b=a.replace(/__PLUS__/gi,"+");return b=b.replace(/__OPENBRACE__/gi,"{"),b=b.replace(/__CLOSEBRACE__/gi,"}"),b.replace(/__CLOSEBRACKET__/gi,"]")}function n(a){return null===a||void 0===a}function o(a,b){var c=null;if(n(a))return null;if(a.__SANITIZED)return a;if(Array.isArray(a)){c=[];for(var d=0;d<a.length;d++)c[d]=o(a[d],b)}else switch(typeof a){case"string":c=l(r(a));break;case"object":c={__SANITIZED:!0},b>0?Object.keys(a).forEach(function(d){c[d]=o(a[d],b-1)}):c.__NORECURSE=!0;break;default:c=a}return c}function r(a){var b;do b=a,a=a.replace(q,"");while(a!==b);return a.replace(/</g,"&lt;")}function s(a,b){if(!a||!b)return null;var c="span{"+a.replace(/%/g,"$")+"}",d=v(c,b);return d?d.textContent:null}function t(b){var h,i,j,k,g=a.exec(b),l=g?document.createElement(g[0]):null;if(l){if(e.test(b)&&(i=e.exec(b),j=m(i[0].slice(1,-1)),l.appendChild(document.createTextNode(j))),f.test(b))for(i=f.exec(b),j=m(i[0].slice(1,-1)),b=b.slice(0,i.index)+b.slice(i.index+i[0].length),i=j.split(","),h=0;h<i.length;h++)k=i[h].split("="),2==k.length?l.setAttribute(k[0],k[1]):k.length>2&&l.setAttribute(k[0],k.slice(1).join("="));for(c.test(b)&&(i=c.exec(b),l.id=i[0].slice(1)),i=d.exec(b);i&&i.length;){for(h=0;h<i.length;h++)l.classList.add(i[h].slice(1));i=d.exec(b)}}else e.test(b)&&(i=e.exec(b),j=m(i[0].slice(1,-1)),l=document.createTextNode(j));return l}function u(a,c,d){var j,k,e=d?document.createElement("div"):document.createDocumentFragment(),f=e,g=null,h=i(a,o(c,1),""),l=h.split(b);for(j=0;j<l.length;j++)if(g=t(l[j].trim()),g&&f.appendChild(g),k=b.exec(h),k&&k.length)switch(k[0]){case"<":f=f.parentNode;break;case">":f=g;break;case"+":break;default:console.warn("unrecognized position delimiter:",k)}return d?e.innerHTML:e}function v(a,b){var c=u(a,b);return c&&c.childNodes.length?c.childNodes[0]:null}function w(a,b){if(a&&b){if(g.hasOwnProperty(a))throw new Error("Template '"+a+"' already exists.");g[a]=b}}function x(a){return g[a]||null}function y(a,b){var d,c=h[a];return c&&b?(b&&c.fieldName&&(d=b[c.fieldName]),d.toString()&&c.valueMap.hasOwnProperty(d)?x(c.valueMap[d]):x(c.defaultTemplate)||null):null}function z(a){var b={};return a&&a.split("|").forEach(function(a){var c=a.split(":");b[c[0]]=c[1]}),b}function A(a,b){var c=null;return a?(b&&(c="object"==typeof b?j(a||{},b):b),c):b}function B(a,b){var d,e,f,g,h,i,c=a.getAttribute("data-children-binding");if(a.hasAttribute("data-template-context")&&(h=z(a.getAttribute("data-template-context"),b)),c&&b.hasOwnProperty(c)&&(f=b[c],f&&void 0!==f.length))if(a.hasAttribute("data-template")){if(e=x(a.getAttribute("data-template")))for(a.innerHTML="",d=0;d<f.length;d++)i=A(h,f[d]),g=v(e,i),a.appendChild(g),D(g,f[d])}else if(a.hasAttribute("data-template-map")){var j=a.getAttribute("data-template-map");for(d=0;d<f.length;d++)i=A(h,f[d]),e=y(j,i),e&&(g=v(e,i),a.appendChild(g),D(g,f[d]))}a.hasAttribute("data-children-footer")&&(e=x(a.getAttribute("data-children-footer")),e&&a.appendChild(v(e,b)))}function C(a,b){var d,e,c=a.getAttribute("data-binding");"%self"===c?a.hasAttribute("data-value-string")?(e=a.getAttribute("data-value-string"),k(a,s(e,b))):"object"!=typeof b&&k(a,b):c&&b.hasOwnProperty(c)&&(d=b[c],void 0!==d&&k(a,d))}function D(a,b){var c;a&&b&&(c=a.querySelectorAll("[data-children-binding]"),Array.prototype.forEach.call(c,function(a){B(a,b)}),c=a.querySelectorAll("[data-binding]"),Array.prototype.forEach.call(c,function(a){C(a,b)}))}function E(a,b){h.hasOwnProperty(a)||(h[a]=b)}var a=/^[a-z]+[1-6]?/i,b=/[><\+]/g,c=/#[_a-z]+[_a-z0-9-]*/i,d=/\.-?[_a-z]+[_a-z0-9-]*/gi,e=/{[^}]+}/,f=/\[[^\]]*\]/,g={},h={},p="(?:[^\"'>]|\"[^\"]*\"|'[^']*')*",q=new RegExp("<(?:!--(?:(?:-*[^->])*--+|-?)|script\\b"+p+">[\\s\\S]*?</script\\s*|style\\b"+p+">[\\s\\S]*?</style\\s*|/?[a-z]"+p+")>","gi");return{expand:u,create:v,bind:D,addTemplate:w,getTemplate:x,addConditionalsMap:E}});