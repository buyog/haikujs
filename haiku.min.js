define([],function(){"use strict";function e(e,t,n){return e.indexOf("%self")>-1&&t&&(e=e.replace(/%self/g,t.toString())),e.replace(/\$([^$]*);/g,function(e,r){var a=t[r];c(a)&&(a=n);var i=typeof a;return"string"===i||"number"===i?a:"("+i+")"})}function t(e,t){for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&(e[n]=t[n]);return e}function n(e,t){e&&t&&[].forEach.call(e,t)}function r(e,t){return e&&t?[].filter.call(e,t):null}function a(e,t){return e&&t?[].map.call(e,t):null}function i(e,t){if(!e)return new Error("setNodeValue :: No node specified.");switch(e.tagName){case"INPUT":case"TEXTAREA":case"SELECT":"checkbox"===e.type?e.checked=t:e.value=t;break;default:e.textContent=t}}function l(e){var t=e.replace(/\+/gi,"__PLUS__");return t=t.replace(/\{/gi,"__OPENBRACE__"),t=t.replace(/\}/gi,"__CLOSEBRACE__"),t.replace(/\]/gi,"__CLOSEBRACKET__")}function u(e){var t=e.replace(/__PLUS__/gi,"+");return t=t.replace(/__OPENBRACE__/gi,"{"),t=t.replace(/__CLOSEBRACE__/gi,"}"),t.replace(/__CLOSEBRACKET__/gi,"]")}function c(e){return null===e||void 0===e}function o(e,t){var n=null;if(c(e))return null;if(e.__SANITIZED)return e;if(Array.isArray(e)){n=[];for(var r=0;r<e.length;r++)n[r]=o(e[r],t)}else switch(typeof e){case"string":n=l(d(e));break;case"object":n={__SANITIZED:!0},t>0?Object.keys(e).forEach(function(r){n[r]=o(e[r],t-1)}):n.__NORECURSE=!0;break;default:n=e}return n}function d(e){var t;do t=e,e=e.replace(j,"");while(e!==t);return e.replace(/</g,"&lt;")}function s(e,t){if(!e||!t)return null;var n="span{"+e.replace(/%/g,"$")+"}",r=g(n,t);return r?r.textContent:null}function f(e){var t,n,r,a,i=N.exec(e),l=i?document.createElement(i[0]):null;if(l){if(k.test(e)&&(n=k.exec(e),r=u(n[0].slice(1,-1)),l.appendChild(document.createTextNode(r))),L.test(e))for(n=L.exec(e),r=u(n[0].slice(1,-1)),e=e.slice(0,n.index)+e.slice(n.index+n[0].length),n=r.split(","),t=0;t<n.length;t++)a=n[t].split("="),2==a.length?l.setAttribute(a[0],a[1]):a.length>2&&l.setAttribute(a[0],a.slice(1).join("="));for(O.test(e)&&(n=O.exec(e),l.id=n[0].slice(1)),n=P.exec(e);n&&n.length;){for(t=0;t<n.length;t++)l.classList.add(n[t].slice(1));n=P.exec(e)}}else k.test(e)&&(n=k.exec(e),r=u(n[0].slice(1,-1)),l=document.createTextNode(r));return l}function p(t,n,r){var a,i,l=r?document.createElement("div"):document.createDocumentFragment(),u=l,c=null,d=e(t,o(n,1),""),s=d.split(T);for(a=0;a<s.length;a++)if(c=f(s[a].trim()),c&&u.appendChild(c),i=T.exec(d),i&&i.length)switch(i[0]){case"<":u=u.parentNode;break;case">":u=c;break;case"+":break;default:console.warn("unrecognized position delimiter:",i)}return r?l.innerHTML:l}function g(e,t){var n=p(e,t);return n&&n.childNodes.length?n.childNodes[0]:null}function h(e,t){if(e&&t){if(R.hasOwnProperty(e))throw new Error("Template '"+e+"' already exists.");R[e]=t}}function b(e){var t=R[e];return t||console.warn("Haiku: Cannot find named template '"+e+"'"),t||null}function _(e,t){var n,r=z[e];return r&&t?(t&&r.fieldName&&(n=t[r.fieldName]),n.toString()&&r.valueMap.hasOwnProperty(n)?b(r.valueMap[n]):b(r.defaultTemplate)||null):null}function A(e){var t={};return e&&e.split("|").forEach(function(e){var n=e.split(":");t[n[0]]=n[1]}),t}function v(e,n){var r=null;return e?(n&&(r="object"==typeof n?t(e||{},n):n),r):n}function m(e,t){var n,r,a,i,l,u,c=e.getAttribute("data-children-binding");if(e.hasAttribute("data-template-context")&&(l=A(e.getAttribute("data-template-context"),t)),e.innerHTML="",e.hasAttribute("data-children-prelude")&&(r=b(e.getAttribute("data-children-prelude")),r&&(u=v(l,t),i=g(r,u),e.appendChild(i),C(i,u))),c&&t.hasOwnProperty(c)&&(a=t[c],a&&void 0!==a.length))if(e.hasAttribute("data-template")){if(r=b(e.getAttribute("data-template")))for(n=0;n<a.length;n++)u=v(l,a[n]),i=g(r,u),e.appendChild(i),C(i,u)}else if(e.hasAttribute("data-template-map")){var o=e.getAttribute("data-template-map");for(n=0;n<a.length;n++)u=v(l,a[n]),r=_(o,u),r&&(i=g(r,u),e.appendChild(i),C(i,u))}e.hasAttribute("data-children-footer")&&(r=b(e.getAttribute("data-children-footer")),r&&(u=v(l,t),i=g(r,u),e.appendChild(i),C(i,u)))}function E(e,t){var n,r,a=e.getAttribute("data-binding");return"%self"===a?e.hasAttribute("data-value-string")?(r=e.getAttribute("data-value-string"),i(e,s(r,t))):"object"!=typeof t&&i(e,t):a&&t.hasOwnProperty(a)&&(n=t[a],void 0!==n&&i(e,n)),e}function C(e,t){var i;e&&t&&(i=e.querySelectorAll("[data-binding]"),n(i,x),i=e.querySelectorAll("[data-children-binding]"),n(i,function(e){m(e,t)}),i=e.querySelectorAll("[data-binding]"),n(a(r(i,S),function(e){return E(e,t)}),y))}function x(e){return e&&e.setAttribute&&e.setAttribute("data-binding-pending",!0),e}function y(e){return e&&e.removeAttribute&&e.removeAttribute("data-binding-pending"),e}function S(e){return e&&e.getAttribute?e.getAttribute("data-binding-pending"):!1}function w(e,t){z.hasOwnProperty(e)||(z[e]=t)}var N=/^[a-z]+[1-6]?/i,T=/[><\+]/g,O=/#[_a-z]+[_a-z0-9-]*/i,P=/\.-?[_a-z]+[_a-z0-9-]*/gi,k=/{[^}]+}/,L=/\[[^\]]*\]/,R={},z={},B="(?:[^\"'>]|\"[^\"]*\"|'[^']*')*",j=new RegExp("<(?:!--(?:(?:-*[^->])*--+|-?)|script\\b"+B+">[\\s\\S]*?</script\\s*|style\\b"+B+">[\\s\\S]*?</style\\s*|/?[a-z]"+B+")>","gi");return{expand:p,create:g,bind:C,addTemplate:h,getTemplate:b,addConditionalsMap:w}});
//# sourceMappingURL=haiku.min.js.map